<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
</head>
<body>
  <h1>You are logged in</h1>
  <a href="{{url_for('auth.logout')}}">Logout</a><br><br>

  <h1>Welcome, {{ current_user.username }}!</h1>

  <h2>Upload a file</h2>
  <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload.upload_file') }}">
    {{ upload_form.hidden_tag() }}
    <p>
      {{ upload_form.file.label }}<br>
      {{ upload_form.file() }}
    </p>
    <p>{{ upload_form.submit(class="btn btn-primary") }}</p>
  </form>

  <h2>Your files</h2>
  {% if files %}
    <table>
      <thead>
        <tr><th>Filename</th><th>Size</th><th>Uploaded</th><th>Actions</th></tr>
      </thead>
      <tbody>
      {% for f in files %}
        <tr>
          <td>{{ f.original_filename }}</td>
          <td>{{ (f.size // 1024) }} KB</td>
          <td>{{ f.upload_time.strftime("%Y-%m-%d %H:%M:%S") }}</td>
          <td>
            <a href="{{ url_for('upload.download_file', file_id=f.id) }}">Download</a>
            <form action="{{ url_for('upload.delete_file', file_id=f.id) }}" method="post" style="display:inline;">
              <button type="submit" onclick="return confirm('Delete file?')">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>You have no files uploaded yet.</p>
  {% endif %}
</body>
</html>